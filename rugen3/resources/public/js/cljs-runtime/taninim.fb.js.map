{"version":3,"sources":["taninim/fb.cljs"],"mappings":";AAGA,oBAAA,pBAAeA;AAEf,GAAA,QAAAC,oCAAAC,uCAAAC;AAAA;AAAA,AAAA,AAAmBC,gCAAa,6CAAA,7CAACC;;AAEjC,mCAAA,nCAAOC,8EAAwBC;AAA/B,AAAA,kDAAA,+EAAA,6FAAA,oGAAA,uFAAA,7SACiC,AAAUA,wFACV,AAAeA,kGACf,AAAiBA,2FACjB,AAAaA,0HACb,AAA+BA;;AAEhE,mCAAA,nCAAOC,8EAA2BC;AAAlC,AACE,GAAI,6CAAA,7CAACC,yDAAc,AAAUD;AAC3B,8BAAA,mFAAA,1GAACE,sKAAyB,AAACL,iCAAmB,AAAgBG;;AAC9D,8BAAA,mFAAA,iEAAA,2CAAA,tNAACE,gRAAoC,AAAUF;;;AAEnD,yBAAA,zBAAOG;AAAP,AACE,GAAM,EAAK,QAAAC,yBAAgB,cAAA,AAAAC,dAACC,8BAAKX;AAAjC,AACE,QAAA,wCAAA,eAAA,iBAAA,hFAAOS,mBACcb;;AAIrB,2DAAA,pDAACgB,sBAAOZ;;AANV;;;AAQF,mBAAA,nBAAMa;AAAN,AACE,AAACL;;AACD,iDAAA,WAAA,rDAAQC,SACAL;;AAGV,kBAAA,lBAAMU;AAAN,AACE,OAACN","names":["taninim.fb/app-id","js/taninim","js/taninim.fb","js/taninim.fb.initialized?","taninim.fb/initialized?","cljs.core.atom","taninim.fb/auth-response->map","auth-response","taninim.fb/handle-login-response","response","cljs.core._EQ_","re-frame.core/dispatch","taninim.fb/ensure-init","js/FB","cljs.core/deref","cljs.core/not","cljs.core/reset!","taninim.fb/login","taninim.fb/init"],"sourcesContent":["(ns taninim.fb\n  (:require [re-frame.core :as rf]))\n\n(def ^:private app-id \"398404340829160\")\n\n(defonce ^:private initialized? (atom false))\n\n(defn- auth-response->map [^js auth-response]\n  {:userID                       (.-userID auth-response)\n   :accessToken                  (.-accessToken auth-response)\n   :signedRequest                (.-signedRequest auth-response)\n   :expiresIn                    (.-expiresIn auth-response)\n   :data_access_expiration_time  (.-data_access_expiration_time auth-response)})\n\n(defn- handle-login-response [^js response]\n  (if (= \"connected\" (.-status response))\n    (rf/dispatch [:auth/login (auth-response->map (.-authResponse response))])\n    (rf/dispatch [:auth/failure {:reason (.-status response)}])))\n\n(defn- ensure-init []\n  (when (and (exists? js/FB) (not @initialized?))\n    (.init js/FB\n           #js {:appId   app-id\n                :cookie  true\n                :xfbml   true\n                :version \"v19.0\"})\n    (reset! initialized? true)))\n\n(defn login []\n  (ensure-init)\n  (.login js/FB\n          handle-login-response\n          #js {:scope \"public_profile,email\"}))\n\n(defn init []\n  (ensure-init))\n"]}