{"version":3,"sources":["taninim/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_fx","p__12445","p__12446","map__12447","cljs.core/--destructure-map","cljs.core.get","vec__12448","cljs.core.nth","db","_","ext-auth-response","cljs.core/assoc-in","re_frame.core.reg_event_db","p__12451","vec__12452","map__12455","user-id","token","fb-user-id","cljs.core.get_in","taninim.state/persist-auth!","p__12456","vec__12457","_error","p__12463","map__12464","p__12465","vec__12466","albums","p__12469","vec__12470","p__12473","p__12474","map__12475","vec__12476","album-id","cljs.core.update_in","cljs.core/conj","p__12479","vec__12480","cljs.core/disj","p__12485","p__12486","map__12487","vec__12488","p__12491","vec__12492","p__12495","vec__12496","p__12499","vec__12500","_album-id","p__12503","p__12504","map__12505","vec__12506","track","js/console.log","cljs.core/clj->js","p__12509","map__12510","p__12512","map__12513","p__12515","vec__12516","tracks"],"sourcesContent":["(ns taninim.events\n  (:require [re-frame.core :as rf]\n            [taninim.api :as api]\n            [taninim.state :as state]))\n\n;; --- Auth ---\n\n(rf/reg-event-fx\n  :auth/login\n  (fn [{:keys [db]} [_ ext-auth-response]]\n    {:db (-> db\n             (assoc-in [:auth :status] :authenticating)\n             (assoc-in [:auth :fb-user-id] (:userID ext-auth-response)))\n     :fx [[:dispatch [:api/authenticate ext-auth-response]]]}))\n\n(rf/reg-event-db\n  :auth/success\n  (fn [db [_ {:keys [user-id token]}]]\n    (let [fb-user-id (get-in db [:auth :fb-user-id])]\n      (state/persist-auth! {:user-id user-id\n                            :fb-user-id fb-user-id\n                            :token token})\n      (-> db\n          (assoc-in [:auth :user-id] user-id)\n          (assoc-in [:auth :token] token)\n          (assoc-in [:auth :status] :authenticated)))))\n\n(rf/reg-event-db\n  :auth/failure\n  (fn [db [_ _error]]\n    (assoc-in db [:auth :status] :unauthenticated)))\n\n;; --- Library ---\n\n(rf/reg-event-fx\n  :library/fetch\n  (fn [{:keys [db]} _]\n    {:db (assoc-in db [:library :loading?] true)\n     :fx [[:dispatch [:api/fetch-library]]]}))\n\n(rf/reg-event-db\n  :library/loaded\n  (fn [db [_ albums]]\n    (-> db\n        (assoc-in [:library :albums] albums)\n        (assoc-in [:library :loading?] false))))\n\n(rf/reg-event-db\n  :library/fetch-failed\n  (fn [db [_ _error]]\n    (-> db\n        (assoc-in [:library :loading?] false)\n        (assoc-in [:library :error] true))))\n\n;; --- Leases ---\n\n(rf/reg-event-fx\n  :lease/acquire\n  (fn [{:keys [db]} [_ album-id]]\n    {:db (update-in db [:leases :pending] conj album-id)\n     :fx [[:dispatch [:api/acquire-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/acquired\n  (fn [db [_ album-id]]\n    (-> db\n        (update-in [:leases :pending] disj album-id)\n        (update-in [:leases :active] conj album-id))))\n\n(rf/reg-event-fx\n  :lease/release\n  (fn [{:keys [db]} [_ album-id]]\n    {:db (update-in db [:leases :active] disj album-id)\n     :fx [[:dispatch [:api/release-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/released\n  (fn [db [_ album-id]]\n    (update-in db [:leases :active] disj album-id)))\n\n(rf/reg-event-db\n  :lease/acquire-failed\n  (fn [db [_ album-id _error]]\n    (update-in db [:leases :pending] disj album-id)))\n\n(rf/reg-event-db\n  :lease/release-failed\n  (fn [db [_ _album-id _error]]\n    db))\n\n;; --- Player ---\n\n(rf/reg-event-fx\n  :player/play\n  (fn [{:keys [db]} [_ track]]\n    (js/console.log \"player/play\" (clj->js track))\n    (let [token (get-in db [:auth :token])]\n      {:db (-> db\n               (assoc-in [:player :current-track] track)\n               (assoc-in [:player :state] :playing))\n       :audio/play {:track track :token token}})))\n\n(rf/reg-event-fx\n  :player/pause\n  (fn [{:keys [db]} _]\n    {:db (assoc-in db [:player :state] :paused)\n     :audio/pause true}))\n\n(rf/reg-event-fx\n  :player/stop\n  (fn [{:keys [db]} _]\n    {:db (-> db\n             (assoc-in [:player :current-track] nil)\n             (assoc-in [:player :state] :stopped)\n             (assoc-in [:player :position] 0))\n     :audio/stop true}))\n\n(rf/reg-event-db\n  :player/set-playlist\n  (fn [db [_ tracks]]\n    (assoc-in db [:player :playlist] tracks)))\n"]}