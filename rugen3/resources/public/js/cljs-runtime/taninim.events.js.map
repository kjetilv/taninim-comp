{"version":3,"sources":["taninim/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_fx","p__12445","p__12446","map__12447","cljs.core/--destructure-map","cljs.core.get","vec__12448","cljs.core.nth","db","_","ext-auth-response","cljs.core/assoc-in","re_frame.core.reg_event_db","p__12451","vec__12452","map__12455","user-id","token","p__12456","vec__12457","_error","p__12461","map__12462","p__12463","vec__12464","albums","p__12467","vec__12469","p__12473","p__12474","map__12475","vec__12476","album-id","cljs.core.update_in","cljs.core/conj","p__12479","vec__12480","cljs.core/disj","p__12483","p__12484","map__12485","vec__12486","p__12489","vec__12490","p__12494","vec__12495","p__12498","vec__12499","_album-id","p__12503","p__12504","map__12505","vec__12506","track","js/console.log","cljs.core/clj->js","cljs.core.get_in","p__12509","map__12510","p__12511","map__12512","p__12513","vec__12514","tracks"],"sourcesContent":["(ns taninim.events\n  (:require [re-frame.core :as rf]\n            [taninim.api :as api]))\n\n;; --- Auth ---\n\n(rf/reg-event-fx\n  :auth/login\n  (fn [{:keys [db]} [_ ext-auth-response]]\n    {:db (-> db\n             (assoc-in [:auth :status] :authenticating)\n             (assoc-in [:auth :fb-user-id] (:userID ext-auth-response)))\n     :fx [[:dispatch [:api/authenticate ext-auth-response]]]}))\n\n(rf/reg-event-db\n  :auth/success\n  (fn [db [_ {:keys [user-id token]}]]\n    (-> db\n        (assoc-in [:auth :user-id] user-id)\n        (assoc-in [:auth :token] token)\n        (assoc-in [:auth :status] :authenticated))))\n\n(rf/reg-event-db\n  :auth/failure\n  (fn [db [_ _error]]\n    (assoc-in db [:auth :status] :unauthenticated)))\n\n;; --- Library ---\n\n(rf/reg-event-fx\n  :library/fetch\n  (fn [{:keys [db]} _]\n    {:db (assoc-in db [:library :loading?] true)\n     :fx [[:dispatch [:api/fetch-library]]]}))\n\n(rf/reg-event-db\n  :library/loaded\n  (fn [db [_ albums]]\n    (-> db\n        (assoc-in [:library :albums] albums)\n        (assoc-in [:library :loading?] false))))\n\n(rf/reg-event-db\n  :library/fetch-failed\n  (fn [db [_ _error]]\n    (-> db\n        (assoc-in [:library :loading?] false)\n        (assoc-in [:library :error] true))))\n\n;; --- Leases ---\n\n(rf/reg-event-fx\n  :lease/acquire\n  (fn [{:keys [db]} [_ album-id]]\n    {:db (update-in db [:leases :pending] conj album-id)\n     :fx [[:dispatch [:api/acquire-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/acquired\n  (fn [db [_ album-id]]\n    (-> db\n        (update-in [:leases :pending] disj album-id)\n        (update-in [:leases :active] conj album-id))))\n\n(rf/reg-event-fx\n  :lease/release\n  (fn [{:keys [db]} [_ album-id]]\n    {:db (update-in db [:leases :active] disj album-id)\n     :fx [[:dispatch [:api/release-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/released\n  (fn [db [_ album-id]]\n    (update-in db [:leases :active] disj album-id)))\n\n(rf/reg-event-db\n  :lease/acquire-failed\n  (fn [db [_ album-id _error]]\n    (update-in db [:leases :pending] disj album-id)))\n\n(rf/reg-event-db\n  :lease/release-failed\n  (fn [db [_ _album-id _error]]\n    db))\n\n;; --- Player ---\n\n(rf/reg-event-fx\n  :player/play\n  (fn [{:keys [db]} [_ track]]\n    (js/console.log \"player/play\" (clj->js track))\n    (let [token (get-in db [:auth :token])]\n      {:db (-> db\n               (assoc-in [:player :current-track] track)\n               (assoc-in [:player :state] :playing))\n       :audio/play {:track track :token token}})))\n\n(rf/reg-event-fx\n  :player/pause\n  (fn [{:keys [db]} _]\n    {:db (assoc-in db [:player :state] :paused)\n     :audio/pause true}))\n\n(rf/reg-event-fx\n  :player/stop\n  (fn [{:keys [db]} _]\n    {:db (-> db\n             (assoc-in [:player :current-track] nil)\n             (assoc-in [:player :state] :stopped)\n             (assoc-in [:player :position] 0))\n     :audio/stop true}))\n\n(rf/reg-event-db\n  :player/set-playlist\n  (fn [db [_ tracks]]\n    (assoc-in db [:player :playlist] tracks)))\n"]}