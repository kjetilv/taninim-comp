{"version":3,"sources":["taninim/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_fx","p__12613","p__12614","map__12615","cljs.core/--destructure-map","cljs.core.get","vec__12616","cljs.core.nth","db","_","ext-auth-response","cljs.core/assoc-in","re_frame.core.reg_event_db","p__12620","vec__12621","map__12624","user-id","token","p__12625","vec__12626","_error","p__12629","map__12630","p__12632","vec__12633","albums","p__12636","vec__12637","p__12640","p__12641","map__12642","vec__12643","album-id","cljs.core.update_in","cljs.core/conj","p__12646","vec__12647","cljs.core/disj","p__12650","p__12651","map__12652","vec__12653","p__12656","vec__12657","p__12660","vec__12661","p__12664","vec__12665","_album-id","p__12668","vec__12669","track","p__12672","vec__12673","tracks"],"sourcesContent":["(ns taninim.events\n  (:require [re-frame.core :as rf]\n            [taninim.api :as api]))\n\n;; --- Auth ---\n\n(rf/reg-event-fx\n  :auth/login\n  (fn [{:keys [db]} [_ ext-auth-response]]\n    {:db (assoc-in db [:auth :status] :authenticating)\n     :fx [[:dispatch [:api/authenticate ext-auth-response]]]}))\n\n(rf/reg-event-db\n  :auth/success\n  (fn [db [_ {:keys [user-id token]}]]\n    (-> db\n        (assoc-in [:auth :user-id] user-id)\n        (assoc-in [:auth :token] token)\n        (assoc-in [:auth :status] :authenticated))))\n\n(rf/reg-event-db\n  :auth/failure\n  (fn [db [_ _error]]\n    (assoc-in db [:auth :status] :unauthenticated)))\n\n;; --- Library ---\n\n(rf/reg-event-fx\n  :library/fetch\n  (fn [{:keys [db]} _]\n    {:db (assoc-in db [:library :loading?] true)\n     :fx [[:dispatch [:api/fetch-library]]]}))\n\n(rf/reg-event-db\n  :library/loaded\n  (fn [db [_ albums]]\n    (-> db\n        (assoc-in [:library :albums] albums)\n        (assoc-in [:library :loading?] false))))\n\n(rf/reg-event-db\n  :library/fetch-failed\n  (fn [db [_ _error]]\n    (-> db\n        (assoc-in [:library :loading?] false)\n        (assoc-in [:library :error] true))))\n\n;; --- Leases ---\n\n(rf/reg-event-fx\n  :lease/acquire\n  (fn [{:keys [db]} [_ album-id]]\n    {:db (update-in db [:leases :pending] conj album-id)\n     :fx [[:dispatch [:api/acquire-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/acquired\n  (fn [db [_ album-id]]\n    (-> db\n        (update-in [:leases :pending] disj album-id)\n        (update-in [:leases :active] conj album-id))))\n\n(rf/reg-event-fx\n  :lease/release\n  (fn [{:keys [db]} [_ album-id]]\n    {:fx [[:dispatch [:api/release-lease album-id]]]}))\n\n(rf/reg-event-db\n  :lease/released\n  (fn [db [_ album-id]]\n    (update-in db [:leases :active] disj album-id)))\n\n(rf/reg-event-db\n  :lease/acquire-failed\n  (fn [db [_ album-id _error]]\n    (update-in db [:leases :pending] disj album-id)))\n\n(rf/reg-event-db\n  :lease/release-failed\n  (fn [db [_ _album-id _error]]\n    db))\n\n;; --- Player ---\n\n(rf/reg-event-db\n  :player/play\n  (fn [db [_ track]]\n    (-> db\n        (assoc-in [:player :current-track] track)\n        (assoc-in [:player :state] :playing))))\n\n(rf/reg-event-db\n  :player/pause\n  (fn [db _]\n    (assoc-in db [:player :state] :paused)))\n\n(rf/reg-event-db\n  :player/stop\n  (fn [db _]\n    (-> db\n        (assoc-in [:player :current-track] nil)\n        (assoc-in [:player :state] :stopped)\n        (assoc-in [:player :position] 0))))\n\n(rf/reg-event-db\n  :player/set-playlist\n  (fn [db [_ tracks]]\n    (assoc-in db [:player :playlist] tracks)))\n"]}