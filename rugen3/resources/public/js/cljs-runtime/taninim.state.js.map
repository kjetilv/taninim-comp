{"version":3,"sources":["taninim/state.cljs"],"mappings":";AAGA,2BAAA,2CAAA,qDAAA,2CAAA,2DAAA,KAAA,kEAAA,KAAA,wDAAA,KAAA,0DAAA,oFAAA,0DAAA,2CAAA,0DAAA,iCAAA,6DAAA,cAAA,yDAAA,2CAAA,yDAAA,kCAAA,2DAAA,0CAAA,wDAAA,2CAAA,sEAAA,KAAA,6DAAA,iCAAA,8DAAA,IAAA,wDAAA,76CAAKA;AAML,iCAAA,jCAAeC;AAEf,mCAAA,2CAAAC,9EAAMI;AAAN,AAAA,IAAAH,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;cAAA,AAAAE,4CAAAF,eAAA,rEAA6BI;iBAA7B,AAAAF,4CAAAF,eAAA,xEAAqCK;YAArC,AAAAH,4CAAAF,eAAA,nEAAgDM;AAAhD,AACE,OAAUC,qBAAgBT,+BAChB,AAAYU,eAAQ,qBAAA,2CAAA,mEAAA,6EAAA,hNAACC,2HAAkBL,0EACGC,mEACLC;;AAEjD,iCAAA,jCAAMI;AAAN,AACE,OAAaH,wBAAgBT;;AAE/B,6BAAA,7BAAOa;AAAP,AACE,IAAAC,qBAAe,AAAUL,qBAAgBT;AAAzC,AAAA,oBAAAc;AAAA,AAAA,UAAAA,NAAWC;AAAX,AACE,IAAMC,SAAO,4HAAA,2EAAA,vMAACC,0DAAQ,AAAQP,WAAQK;AAAtC,AACE,oBAAM,AAAA,sFAAQC;AAAd,AACEA;;AADF;;;AAFJ;;;AAKF,yDAAA,zDAACE,+HAEC,WAAKC,EAAEA;AAAP,AACE,IAAAC,qBAAc,AAACP;AAAf,AAAA,oBAAAO;AAAA,WAAAA,PAASC;AAAT,AAAA,kDAAA,gkBAAA,kDAAA,mFAAA,mFAAA,6DAAA,mFAAA,10BACWtB,9CACA,uEAAA,vEAACuB,4HAAY,yNAAA,2CAAA,0DAAA,9TAACC,uGAAM,AAAA,mFAAOxB,0BACPsB;;AAH/B,kDAAA,gDAMOtB;;;AAEX,2DAAA,3DAACyB,kKAAiB,WAAKC,GAAGN;AAAR,AAAW,OAAA,mFAAOM;;AACpC,2DAAA,3DAACD,gLAAwB,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,qDAAA,1LAACO,+CAAOD;;AAC5C,2DAAA,3DAACD,4KAAuB,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,qDAAA,1LAACO,+CAAOD;;AAE3C,2DAAA,3DAACD,uKAAoB,WAAKC,GAAGN;AAAR,AAAW,OAAA,wFAAUM;;AAC1C,2DAAA,3DAACD,uKAAmB,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,0DAAA,/LAACO,+CAAOD;;AACvC,2DAAA,3DAACD,yLAA6B,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,0DAAA,/LAACO,+CAAOD;;AAEjD,2DAAA,3DAACD,sKAAmB,WAAKC,GAAGN;AAAR,AAAW,OAAA,uFAASM;;AACxC,2DAAA,3DAACD,oLAA0B,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,yDAAA,9LAACO,+CAAOD;;AAE9C,2DAAA,3DAACD,qKAAmB,WAAKC,GAAGN;AAAR,AAAW,OAAA,sFAASM;;AACxC,2DAAA,3DAACD,kLAAyB,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,wDAAA,7LAACO,+CAAOD;;AAC7C,2DAAA,3DAACD,mLAA0B,WAAKC,GAAGN;AAAR,AAAW,yDAAA,mFAAA,wDAAA,7LAACO,+CAAOD","names":["taninim.state/default-db","taninim.state/auth-storage-key","p__12416","map__12417","cljs.core/--destructure-map","cljs.core.get","taninim.state/persist-auth!","user-id","fb-user-id","token","js/localStorage","js/JSON","cljs.core/clj->js","taninim.state/clear-auth!","taninim.state/restore-auth","temp__5804__auto__","raw","parsed","cljs.core.js__GT_clj","re_frame.core.reg_event_fx","_","temp__5802__auto__","auth","cljs.core.assoc","cljs.core.merge","re_frame.core.reg_sub","db","cljs.core.get_in"],"sourcesContent":["(ns taninim.state\n  (:require [re-frame.core :as rf]))\n\n(def default-db\n  {:auth    {:user-id nil :fb-user-id nil :token nil :status :unauthenticated}\n   :library {:albums [] :loading? false}\n   :leases  {:active #{} :pending #{}}\n   :player  {:current-track nil :playlist [] :position 0 :state :stopped}})\n\n(def ^:private auth-storage-key \"taninim-auth\")\n\n(defn persist-auth! [{:keys [user-id fb-user-id token]}]\n  (.setItem js/localStorage auth-storage-key\n            (.stringify js/JSON (clj->js {:user-id user-id\n                                          :fb-user-id fb-user-id\n                                          :token token}))))\n\n(defn clear-auth! []\n  (.removeItem js/localStorage auth-storage-key))\n\n(defn- restore-auth []\n  (when-let [raw (.getItem js/localStorage auth-storage-key)]\n    (let [parsed (js->clj (.parse js/JSON raw) :keywordize-keys true)]\n      (when (:token parsed)\n        parsed))))\n\n(rf/reg-event-fx\n  :initialize-db\n  (fn [_ _]\n    (if-let [auth (restore-auth)]\n      {:db (-> default-db\n               (assoc :auth (merge (:auth default-db)\n                                   auth\n                                   {:status :authenticated})))\n       :fx [[:dispatch [:library/fetch]]]}\n      {:db default-db})))\n\n(rf/reg-sub :auth (fn [db _] (:auth db)))\n(rf/reg-sub :auth-status (fn [db _] (get-in db [:auth :status])))\n(rf/reg-sub :auth-token (fn [db _] (get-in db [:auth :token])))\n\n(rf/reg-sub :library (fn [db _] (:library db)))\n(rf/reg-sub :albums (fn [db _] (get-in db [:library :albums])))\n(rf/reg-sub :library-loading? (fn [db _] (get-in db [:library :loading?])))\n\n(rf/reg-sub :leases (fn [db _] (:leases db)))\n(rf/reg-sub :active-leases (fn [db _] (get-in db [:leases :active])))\n\n(rf/reg-sub :player (fn [db _] (:player db)))\n(rf/reg-sub :player-state (fn [db _] (get-in db [:player :state])))\n(rf/reg-sub :current-track (fn [db _] (get-in db [:player :current-track])))\n"]}